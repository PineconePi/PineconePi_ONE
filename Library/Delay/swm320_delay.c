/****************************************************************************************************************************************** 
* 文件名称: SWM320_delay.c
* 功能说明:	SWM320单片机的延时功能驱动库
* 技术支持: 电子芯吧客首席评测师 徐珂靖 
           https://www.icxbk.com/expert/detail/25.html	
* 注意事项: Delay_Init要放在SystemInit后面。
           Delay_Init把定时器5用掉了，注意功能冲突
	   
* 版本日期:	V0.0.1		2019年07月02日
* 升级记录: 
*
*
*******************************************************************************************************************************************/
#include "SWM320.h"
#include "swm320_delay.h"


__IO uint32_t uwTick;//毫秒计数值

/****************************************************************************************************************************************** 
* 函数名称: Delay_Init()
* 功能说明:	
* 输    入: 无
* 注意事项: 把定时器5用掉了，注意功能冲突
******************************************************************************************************************************************/
void Delay_Init(void)
{
	uwTick=0;//从0开始计数
	TIMR_Init(TIMR5, TIMR_MODE_TIMER, SystemCoreClock/1000, 1);
	TIMR_Start(TIMR5);
}
/****************************************************************************************************************************************** 
* 函数名称: IncTick()
* 功能说明: 把计数值加1
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void IncTick(void)
{
	uwTick++;
}
/****************************************************************************************************************************************** 
* 函数名称: GetTick()
* 功能说明: 获取毫秒计数值
* 输    入: 无
* 输    出: uint32_t uwTick 
* 注意事项: 无
******************************************************************************************************************************************/
uint32_t GetTick(void)
{
	return uwTick;
}
/****************************************************************************************************************************************** 
* 函数名称: TIMR5_Handler()
* 功能说明: 定时每1毫秒把毫秒计数值加1
* 输    入: 无
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/
void TIMR5_Handler(void)
{
	TIMR_INTClr(TIMR5);
	IncTick();
}
/****************************************************************************************************************************************** 
* 函数名称: delay()
* 功能说明:	毫秒延时
* 输    入: uint32_t Delay 要延时多少毫秒
* 输    出: 无
* 注意事项: 无
******************************************************************************************************************************************/

void delay(__IO uint32_t Delay)
{
  uint32_t tickstart = GetTick();
  uint32_t wait = Delay;
  while((GetTick() - tickstart) < wait)
  {
  }
}



